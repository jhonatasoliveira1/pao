<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto Além do Olhar - Cadastro</title>
    <style>
        :root {
            --primary-color: #0056b3;
            --bg-color: #f4f7f6;
            --text-color: #333;
            --error-color: #dc3545;
            --warning-bg: #fff3cd;
            --warning-text: #856404;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            line-height: 1.6;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 40px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        h1 { text-align: center; color: var(--primary-color); margin-bottom: 10px; }
        h2 { border-bottom: 2px solid var(--primary-color); padding-bottom: 10px; margin-top: 30px; color: var(--primary-color); }
        h3 { color: #555; margin-top: 20px; font-size: 1.1em; border-left: 4px solid var(--primary-color); padding-left: 10px; }
        .intro { text-align: center; font-size: 0.9em; color: #666; margin-bottom: 30px; }
        
        .form-group { margin-bottom: 15px; position: relative; }
        label { display: block; margin-bottom: 5px; font-weight: 600; }
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            box-sizing: border-box;
        }
        input:focus, select:focus { border-color: var(--primary-color); outline: none; }
        
        /* Campo Readonly (Endereço Automático) */
        input[readonly] { background-color: #e9ecef; color: #555; cursor: default; }

        /* Caixa de Alerta (Telefones) */
        .alert-box {
            background-color: var(--warning-bg);
            color: var(--warning-text);
            padding: 15px;
            border: 1px solid #ffeeba;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 0.95em;
        }

        /* Campo de carregamento do CEP */
        .cep-loading { 
            position: absolute; 
            right: 10px; 
            top: 38px; 
            font-size: 0.8em; 
            color: var(--primary-color); 
            display: none; 
        }

        /* Estilos de Erro */
        input.error { border-color: var(--error-color); background-color: #fff8f8; }
        .error-msg { color: var(--error-color); font-size: 0.85em; display: none; margin-top: 5px; }
        
        /* Campo Condicional (Outra Deficiência) */
        #divOutraDeficiencia {
            display: none;
            margin-top: 10px;
            background-color: #f0f8ff;
            padding: 10px;
            border-radius: 4px;
            border-left: 3px solid var(--primary-color);
        }

        .btn-submit {
            display: block;
            width: 100%;
            padding: 15px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 18px;
            cursor: pointer;
            margin-top: 30px;
            transition: background 0.3s;
        }
        .btn-submit:hover { background-color: #004494; }
        
        #loading { display: none; text-align: center; font-weight: bold; color: var(--primary-color); margin-top: 15px;}
        #success-message { display: none; text-align: center; color: green; padding: 20px; border: 1px solid green; background: #e8f5e9; border-radius: 4px;}
        #form-content { display: block; }
    </style>
</head>
<body>

<div class="container">
    <div id="success-message">
        <h3>Cadastro realizado com sucesso!</h3>
        <p>Os dados foram enviados para a central do projeto.</p>
        <button onclick="location.reload()" style="margin-top:10px; padding:10px; cursor:pointer;">Novo Cadastro</button>
    </div>

    <div id="form-content">
        <h1>PROJETO ALÉM DO OLHAR</h1>
        <p class="intro">Reabilitação Visual na Saúde e na Educação - FAV/PCR</p>

        <form id="myForm" novalidate>
            
            <h2>Identificação da Criança/Adolescente</h2>

            <div class="form-group">
                <label for="Nome Criança">Nome Completo *</label>
                <input type="text" name="Nome Criança" required>
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1; min-width: 150px;">
                    <label for="Idade">Idade (anos) *</label>
                    <input type="number" name="Idade" required>
                </div>
                <div class="form-group" style="flex: 1; min-width: 150px;">
                    <label for="Data Nascimento">Data de Nascimento *</label>
                    <input type="date" name="Data Nascimento" required>
                </div>
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1; min-width: 200px;">
                    <label for="CNS">Cartão SUS (CNS) *</label>
                    <input type="text" id="CNS" name="CNS" required placeholder="000 0000 0000 0000" maxlength="18">
                    <span class="error-msg">CNS Inválido.</span>
                </div>
                <div class="form-group" style="flex: 1; min-width: 200px;">
                    <label for="CPF">CPF *</label>
                    <input type="text" id="CPF" name="CPF" required placeholder="000.000.000-00" maxlength="14">
                    <span class="error-msg">CPF inválido.</span>
                </div>
            </div>

            <div class="form-group">
                <label for="Nome Mãe">Nome da Mãe *</label>
                <input type="text" name="Nome Mãe" required>
            </div>

            <div class="form-group">
                <label for="Raça/Cor">Raça/Cor *</label>
                <select name="Raça/Cor" required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Branca">Branca</option>
                    <option value="Preta">Preta</option>
                    <option value="Parda">Parda</option>
                    <option value="Amarela">Amarela</option>
                    <option value="Indígena">Indígena</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Sexo">Sexo *</label>
                <select name="Sexo" required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Masculino">Masculino</option>
                    <option value="Feminino">Feminino</option>
                    <option value="Outro">Outro</option>
                </select>
            </div>

            <div class="form-group">
                <label for="Deficiência">Deficiência (Motivo do encaminhamento) *</label>
                <select name="Deficiência" id="selectDeficiencia" required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Suspeita de baixa visão">Suspeita de baixa visão</option>
                    <option value="Síndrome Congênita do Zika Vírus (SCZV)">Síndrome Congênita do Zika Vírus (SCZV)</option>
                    <option value="Deficiência visual - Baixa visão">Deficiência visual - Baixa visão</option>
                    <option value="Deficiência visual - Cegueira">Deficiência visual - Cegueira</option>
                    <option value="Múltiplas deficiências associadas à baixa visão ou cegueira">Múltiplas deficiências associadas à baixa visão ou cegueira</option>
                    <option value="Autismo associado à baixa visão ou cegueira">Autismo associado à baixa visão ou cegueira</option>
                    <option value="Outra">Outra</option>
                </select>
                <div id="divOutraDeficiencia">
                    <label for="Outra Deficiencia">Qual a deficiência? *</label>
                    <input type="text" name="Outra Deficiencia" id="inputOutraDeficiencia">
                </div>
            </div>

            <div class="form-group">
                <label for="Escolaridade">Escolaridade *</label>
                <select name="Escolaridade" required>
                    <option value="" disabled selected>Selecione...</option>
                    <option value="Educação Infantil">Educação Infantil</option>
                    <optgroup label="Ensino Fundamental I">
                        <option value="1º Ano Fundamental">1º Ano Fundamental</option>
                        <option value="2º Ano Fundamental">2º Ano Fundamental</option>
                        <option value="3º Ano Fundamental">3º Ano Fundamental</option>
                        <option value="4º Ano Fundamental">4º Ano Fundamental</option>
                        <option value="5º Ano Fundamental">5º Ano Fundamental</option>
                    </optgroup>
                    <optgroup label="Ensino Fundamental II">
                        <option value="6º Ano Fundamental">6º Ano Fundamental</option>
                        <option value="7º Ano Fundamental">7º Ano Fundamental</option>
                        <option value="8º Ano Fundamental">8º Ano Fundamental</option>
                        <option value="9º Ano Fundamental">9º Ano Fundamental</option>
                    </optgroup>
                    <optgroup label="Ensino Médio">
                        <option value="1º Ano Médio">1º Ano Médio</option>
                        <option value="2º Ano Médio">2º Ano Médio</option>
                        <option value="3º Ano Médio">3º Ano Médio</option>
                    </optgroup>
                    <option value="Não estuda">Não estuda</option>
                </select>
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1;">
                    <label for="Turno">Turno *</label>
                    <select name="Turno" required>
                        <option value="Manhã">Manhã</option>
                        <option value="Tarde">Tarde</option>
                        <option value="Não estuda">Não estuda</option>
                    </select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="Turma">Turma *</label>
                    <input type="text" name="Turma" required placeholder="Ex: A, 102...">
                </div>
            </div>

            <div class="form-group">
                <label for="CEP">CEP *</label>
                <input type="text" id="campoCEP" name="CEP" required placeholder="00000-000" maxlength="9">
                <span class="cep-loading" id="msgCEP">Buscando endereço...</span>
            </div>

            <div class="form-group">
                <label for="end_logradouro">Logradouro (Rua/Av) *</label>
                <input type="text" id="end_logradouro" required placeholder="Aguardando CEP...">
            </div>

            <div class="form-group">
                <label for="end_bairro">Bairro *</label>
                <input type="text" id="end_bairro" required placeholder="Aguardando CEP...">
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1;">
                    <label for="end_numero">Número *</label>
                    <input type="text" id="end_numero" required placeholder="Nº da casa">
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="end_complemento">Complemento (Opcional)</label>
                    <input type="text" id="end_complemento" placeholder="Ex: Casa B, Apto 101">
                </div>
            </div>

            <input type="hidden" name="Endereço" id="enderecoFinal">

            <h3>Contatos e Responsáveis</h3>

            <div class="alert-box">
                <strong>⚠️ ATENÇÃO:</strong><br>
                Os telefones devem ser de <strong>pessoas que acompanham e cuidam da criança</strong> (Mãe, Pai, Avó...).<br>
                É obrigatório informar <strong>dois números diferentes</strong> para contato.
            </div>
            
            <div style="background-color: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 10px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="Tel Responsável">Telefone Principal *</label>
                        <input type="tel" id="Tel1" name="Tel Responsável" required placeholder="(xx) 9xxxx-xxxx" maxlength="15">
                        <span class="error-msg">Preencha DDD + 9 dígitos.</span>
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="Quem Contato 1">De quem é este número? *</label>
                        <input type="text" name="Quem Contato 1" required placeholder="Ex: Mãe, Pai, Vizinha...">
                    </div>
                </div>
            </div>

            <div style="background-color: #f9f9f9; padding: 10px; border-radius: 5px; margin-bottom: 15px;">
                <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="Tel Segundo Contato">Telefone Secundário *</label>
                        <input type="tel" id="Tel2" name="Tel Segundo Contato" required placeholder="(xx) 9xxxx-xxxx" maxlength="15">
                        <span class="error-msg" id="msg-tel2">Preencha DDD + 9 dígitos.</span>
                        <span class="error-msg" id="msg-duplicate-tel" style="color: red; font-weight: bold;">Os telefones não podem ser iguais.</span>
                    </div>
                    <div class="form-group" style="flex: 1; min-width: 200px;">
                        <label for="Quem Contato 2">De quem é este número? *</label>
                        <input type="text" name="Quem Contato 2" required placeholder="Ex: Avó, Tio, Irmão...">
                    </div>
                </div>
            </div>
          
            <h2>Identificação da Unidade Solicitante</h2>

            <div class="form-group">
                <label for="Unidade Solicitante">Nome da Unidade * (Digite para buscar)</label>
                <input type="text" list="listaUnidades" id="inputUnidade" name="Unidade Solicitante" required placeholder="Ex: Escola Municipal..." autocomplete="off">
                <datalist id="listaUnidades">
                    </datalist>
            </div>

            <div class="form-group">
                <label for="Endereço Unidade">Endereço da Unidade *</label>
                <input type="text" id="inputEnderecoUnidade" name="Endereço Unidade" readonly required placeholder="Preenchimento automático">
            </div>

            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <div class="form-group" style="flex: 1;">
                    <label for="RPA">RPA</label>
                    <select name="RPA"><option value="">Selecione...</option><option value="1">1</option><option value="2">2</option><option value="3">3</option><option value="4">4</option><option value="5">5</option><option value="6">6</option></select>
                </div>
                <div class="form-group" style="flex: 1;">
                    <label for="Distrito Sanitário">Distrito Sanitário</label>
                    <select name="Distrito Sanitário"><option value="">Selecione...</option><option value="I">I</option><option value="II">II</option><option value="III">III</option><option value="IV">IV</option><option value="V">V</option><option value="VI">VI</option><option value="VII">VII</option><option value="VIII">VIII</option></select>
                </div>
            </div>

            <div class="form-group">
                <label for="Profissional Solicitante">Nome do Profissional Solicitante *</label>
                <input type="text" name="Profissional Solicitante" required>
            </div>

            <div class="form-group">
                <label for="Tel Unidade">Telefone da Unidade *</label>
                <input type="tel" id="TelUnit" name="Tel Unidade" required placeholder="(xx) xxxx-xxxx" maxlength="15">
            </div>

            <button type="submit" class="btn-submit">Enviar Cadastro</button>
            <p id="loading">Enviando dados, aguarde...</p>
        </form>
    </div>
</div>

<script>
    // --- INSIRA SUA URL DO APPS SCRIPT AQUI ---
    const scriptURL = 'https://script.google.com/macros/s/AKfycbySM_xyvbqeXCfy534Fd35KwrqpgC_XmrcaYTW1Oae8lMazRGGMwcxAgTm5GxG80ttX/exec'; 

    const form = document.forms['myForm'];
    const loading = document.getElementById('loading');
    const btn = document.querySelector('.btn-submit');
    const formContent = document.getElementById('form-content');
    const successMessage = document.getElementById('success-message');
    
    // --- BANCO DE DADOS DAS UNIDADES E ENDEREÇOS ---
    const unidadesData = {
        "CMEI Brasília Teimosa": "Rua Delfin, 55, Brasília Teimosa",
        "Colégio Integral em Piedade": "Piedade, Jaboatão dos Guararapes",
        "Creche Escola Ana Rosa Falcão de Carvalho": "Rua João Lira, S/N, Santo Amaro",
        "Creche Escola Associação Cristã Feminina": "Rua Vermelha, 96",
        "Creche Escola Municipal do Bongi": "Rua Major Mário Portela, S/N, Bongi",
        "Creche Escola Municipal do Ibura (Recife do Ibura)": "Av. Expedicionário Francisco Vitoriano, S/N, UR-10, COHAB/Ibura",
        "Creche Escola Recife Governador Miguel Arraes": "Rua Doutor Gilardi Rodrigues dos Santos, 10",
        "Creche Escola Recife Presidente Tancredo Neves": "Av. Dr. José Rufino, S/N",
        "Creche Escola Recife Santa Luzia": "Rua Souza Bandeira, S/N, Torre",
        "Creche Vinde a Mim as Criancinhas": "Rua Édeia, S/N, Madalena",
        "EM Casa dos Ferroviários": "Rua Doutor José Cornélio, 84, Coqueiral",
        "EM Dois Rios": "Rua Irmã Maria Evangelista, 83, COHAB",
        "EM Doutor Antônio Correia": "Rua Teófilo Otoni, 960/980, Barro",
        "EM Educador Paulo Freire": "Av. General Bento da Gama, 301, Ipsep",
        "EM Engenheiro Henoch Coutinho de Melo": "Rua das Oficinas, 12, Brasília Teimosa",
        "EM Historiador Flávio Guerra": "Rua Alto da Telha, 320, Passarinho",
        "EM Hugo Gerdau": "Rua Coronel Mizael de Mendonça, S/N, San Martin",
        "EM Irmã Terezinha Batista": "Rua Iguatu, S/N, Campina do Barreto",
        "EM Jader Figueiredo de Andrade Silva": "Avenida Múcio Uchoa Cavalcante, 283, Engenho do Meio",
        "EM Margarida Siqueira Pessoa": "Rua Córrego do Euclides (ou José Grande), 1307, Casa Amarela",
        "EM Parque dos Milagres": "Rua Cantor Leandro, S/N, Barro",
        "EM Pedro Alcântara": "Rua Três Morros, 43, Córrego do Jenipapo",
        "EM Presbítero José Bezerra": "Avenida Norte Miguel Arraes de Alencar, 7696, Macaxeira",
        "EM Prof. Moacyr de Albuquerque": "Rua Córrego da Areia, S/N, Nova Descoberta",
        "EM Professor Solano Magalhães": "Rua Jamil Asfora, S/N, Pina",
        "EM São João Batista": "Av. Aníbal Benévolo, 1800, Linha do Tiro",
        "EM Sítio do Berardo": "Rua Quatro de Outubro, S/N, Madalena/Prado",
        "EM Sociólogo Gilberto Freyre": "Rua Professor Cláudio Selva, 116, Dois Irmãos",
        "EMTI Alto da Guabiraba": "Rua Presidente Costa e Silva, 250, Brejo da Guabiraba",
        "EMTI da Mangabeira": "Rua Nicéas Arcoverde Gusmão, S/N, Mangabeira",
        "EMTI Maria de Sampaio Lucena": "Av. Pernambuco, S/N, COHAB",
        "EMTI Prof. José da Costa Porto": "Rua Cabo Eutrópio, 660",
        "Escola Municipal Abílio Gomes": "Rua Jorge Couceiro da Costa Eiras, S/N, Boa Viagem",
        "Escola Municipal Almirante Soares Dutra": "Rua Cmte. Arnaldo da Costa Varela, Cabanga",
        "Escola Municipal Alto da Bela Vista": "Rua Alto da Bela, 338, Totó",
        "Escola Municipal Alto Santa Terezinha": "Avenida Aníbal Benévolo, S/N, Beberibe",
        "Escola Municipal Aníbal Varejão": "Rua João Ferreira, 427, Sancho",
        "Escola Municipal Antônio Tibúrcio": "Rua Tamboara, 356",
        "Escola Municipal Balbina Menelau": "Rua João de Andrade, 82, Jardim São Paulo",
        "Escola Municipal Capela Santo Antônio": "Rua São Marcos, S/N, Ilha de Deus",
        "Escola Municipal Casarão do Barbalho": "Estrada do Barbalho, 1595, Iputinga",
        "Escola Municipal Célia Arraes": "Rua José Noya, 131, Várzea",
        "Escola Municipal Cícero Franklin Cordeiro": "Felipe dos Santos, 81, UR-05, Ibura",
        "Escola Municipal Compositor Capiba": "Rua Othon Paraíso, 375, Torreão",
        "Escola Municipal Compositor Levino Ferreira": "Rua Córrego José Grande, 500, Casa Amarela",
        "Escola Municipal Córrego da Bica": "Rua Córrego da Bica, S/N, Passarinho",
        "Escola Municipal Córrego do Euclides": "Rua Tibiriçá, 48, Morro da Conceição",
        "Escola Municipal da Guabiraba": "Rua Cassiterita, 295",
        "Escola Municipal da Iputinga": "Rua Coronel Fernando Furtado, 479, Iputinga",
        "Escola Municipal da Mangabeira": "Rua do Cinema, 287, Mangabeira",
        "Escola Municipal Darcy Ribeiro": "Rua Odete Monteiro, 450, Cordeiro",
        "Escola Municipal de Água Fria": "Rua dos Craveiros, 500, Campina do Barreto",
        "Escola Municipal de Beberibe": "Rua Melânio de Barros Correia, 25, Beberibe",
        "Escola Municipal de Tejipió": "Rua Tutóia, 165, Tejipió",
        "Escola Municipal Deocleciano Oliveira Lima": "Rua Córrego da Areia, 568, Macaxeira",
        "Escola Municipal Deputado Fernando Sampaio": "Rua Alto Antônio Félix, 105, Nova Descoberta",
        "Escola Municipal Diná de Oliveira": "Rua São Mateus, S/N, Iputinga",
        "Escola Municipal do Barro": "Rua Guaragibe, 117, Barro",
        "Escola Municipal do Coque": "Rua Mirandópolis, 35, Ilha Joana Bezerra",
        "Escola Municipal do Leão": "Rua Bruno Veloso, 300, Boa Viagem",
        "Escola Municipal Dom Hélder Câmara": "Rua Henrique Dias, 278, Recife",
        "Escola Municipal Dona Luci Silva Lima": "Av. Mônaco, 1138, Imbiribeira",
        "Escola Municipal Emídio Dantas Barreto": "Avenida da Saudade, 303, Santo Amaro",
        "Escola Municipal Engenheiro Edinaldo Miranda de Oliveira": "Rua Inácio Galvão dos Santos, 304, Encruzilhada",
        "Escola Municipal Engenheiro Guilherme Diniz": "Rua Teresa Margarida, S/N, UR-6",
        "Escola Municipal Engenheiro Umberto Gondim": "Rua Ivonete Ferreira da Silva, 13, Brasília Teimosa",
        "Escola Municipal Engenho do Meio": "Rua Bom Pastor, S/N, Engenho do Meio",
        "Escola Municipal Futuro Feliz": "Rua Ibirajuba, 440, Três Carneiros Baixo/Ibura",
        "Escola Municipal General San Martin": "Av. General San Martin, 1864, San Martin",
        "Escola Municipal Governador Miguel Arraes de Alencar": "Rua Tapajós, 419, Areias",
        "Escola Municipal Henfil": "Travessa 6 de Março, 10, Várzea",
        "Escola Municipal Inês Soares de Lima": "Rua 14 de Novembro, S/N, Imbiribeira",
        "Escola Municipal Isaac Pereira da Silva": "Rua Oiticica Lins, 211, Areias",
        "Escola Municipal Jardim Mauriceia": "Av. Nicolau Copérnico, 1107, Imbiribeira",
        "Escola Municipal Jardim Monte Verde": "Avenida Chapada do Araripe, 39, COHAB",
        "Escola Municipal Jardim Uchôa": "Rua Jupiatá, 211, Areias",
        "Escola Municipal João Pessoa Guerra": "Rua Isaac Buril, 107, Várzea",
        "Escola Municipal João XXIII": "Estrada do Caiara, 350, Iputinga",
        "Escola Municipal Josefina Marinho": "Rua Córrego José Grande, 1316, Alto José do Pinho",
        "Escola Municipal Júlio Vicente Alves de Araújo": "Praça da Conceição, 468, Morro da Conceição",
        "Escola Municipal Manoel Rolim": "Rua Pajussara, 166, Jardim São Paulo",
        "Escola Municipal Margarida Serpa Cossart": "Rua Mecejana, 09, COHAB UR-02, Ibura",
        "Escola Municipal Mércia de Albuquerque Ferreira": "Rua Tabaiares, 182, Ilha do Retiro",
        "Escola Municipal Nova Descoberta": "Rua Jornalista Waldete Agra, 100, Passarinho",
        "Escola Municipal Nova Morada": "Rua Eliane Fragoso do Nascimento, 24, Caxangá",
        "Escola Municipal Novo Pina": "Rua Eurico Vitrúvio, 236, Pina",
        "Escola Municipal Oswaldo Lima Filho": "Av. Domingos Ferreira, 1040, Pina",
        "Escola Municipal Padre Donino": "Praça de Casa Forte, 442, Casa Forte",
        "Escola Municipal Pais e Filhos": "Rua Dancing Days, 21, Imbiribeira",
        "Escola Municipal Paroquial Cristo Rei": "Rua Dom Manoel da Costa, S/N, Torre",
        "Escola Municipal Paz e Amor": "Rua Jornalista Edson Régis, 216, Ibura",
        "Escola Municipal Pedro Alcântara": "Rua Três Morros, 43, Córrego do Jenipapo",
        "Escola Municipal Pintor Lula Cardoso Ayres": "Rua Álvaro Ferraz, Quadra P, Jordão Baixo",
        "Escola Municipal Poeta Carlos Pena Filho": "Avenida Liberdade, 461, Jardim São Paulo",
        "Escola Municipal Poeta João Cabral de Melo Neto": "Av. Encanta Moça, 377, Pina",
        "Escola Municipal Poeta Manuel Bandeira": "CEP 50070-440",
        "Escola Municipal Poeta Paulo Bandeira da Cruz": "Rua Panelas, 28, COHAB",
        "Escola Municipal Poeta Solano Trindade": "Rua Manuel Silva, 134, Água Fria",
        "Escola Municipal Potiguar Matos": "Rua 21 de Abril, 2191, San Martin",
        "Escola Municipal Prof. Adauto Pontes": "Rua Sertânia, 35, Jordão Alto",
        "Escola Municipal Prof. Antônio de Brito Alves": "Rua Ernesto Cavalcante, 41, Mustardinha",
        "Escola Municipal Prof. Mauro Mota": "Rua Alto da Brasileira, S/N, Nova Descoberta",
        "Escola Municipal Prof. Ricardo Gama": "Rua Guaira, 160, Linha do Tiro",
        "Escola Municipal Prof. Simões Barbosa": "Avenida Dois Rios / Rua Ecoporanga, S/N, Ibura",
        "Escola Municipal Professora Hélia Maria Pereira": "Rua Alice Gomes, 37, Campo Grande",
        "Escola Municipal Professora Primitiva de Barros Silva": "Rua Ator Elpídio Câmara, 122, Jardim São Paulo",
        "Escola Municipal Rozemar de Macedo Lima": "Av. Norte Miguel Arraes de Alencar, 5400, Casa Amarela",
        "Escola Municipal Santa Luzia": "Rua Professor Caldas Filho, 186, Estância",
        "Escola Municipal Santa Maria": "Rua Acaiaca, 70, Alto José do Pinho",
        "Escola Municipal Santa Maria Goretti": "Rua Santa Maria Goretti, 300, Vasco da Gama",
        "Escola Municipal Santo Amaro": "Avenida Norte, 570, Santo Amaro",
        "Escola Municipal Santo Antônio do Caçote": "Rua Guaraci, 16, Areias",
        "Escola Municipal Sede da Sabedoria": "Rua Artemis, 85, Santo Amaro",
        "Escola Municipal Soldado José Antônio do Nascimento": "Rua Carlos Porto Carreiro, 86, Boa Vista",
        "Escola Municipal Vila Santa Luzia": "Rua Elizeu Cavalcanti, 52, Cordeiro",
        "Escola Municipal Virgem Poderosa": "Rua Leonardo Bezerra Cavalcante, 116, Parnamirim",
        "Escola Municipal Zumbi dos Palmares": "Rua Vasconcelos Bittencourt, 35, Várzea",
        "CAPS Luiz Cerqueira": "Rua Álvares de Azevedo, 80, Santo Amaro",
        "Casa de Acolhida Temporária Doce Lar": "Rua Ijuí, 57, Torrões",
        "Casa de Acolhimento Lar Esperança": "Rua Luís Pereira de Farias, 185, Afogados",
        "CER-IV FAV (Fundação Altino Ventura)": "Av. Maurício de Nassau, 2075, Iputinga",
        "DDAS (Divisão Distrital de Atenção à Saúde)": "Rua São Domingos Sávio, 172, Alto José Bonifácio",
        "Distrito Sanitário 2": "Rua Antônio Rangel, 208, Encruzilhada",
        "Distrito Sanitário 3 (Sede)": "Rua Xavantes, 205, Casa Amarela",
        "NAAHS (Núcleo de Atividades Altas Habilidades)": "Estrada do Arraial, 4754, Casa Amarela",
        "UBT Professor Joaquim Cavalcante": "Av. Joaquim Cavalcante / Estrada do Forte, 1350, Torrões",
        "Upinha Emocy Krause": "Rua Cantora Clara Nunes, S/N, Torre",
        "US Ivo Rabelo": "Av. Campina Grande, S/N, UR-01",
        "USF Água Viva": "Rua Porto Nacional, 07",
        "USF Aldenir Ferraz": "Av. Engenho Babilônia, 168, COHAB",
        "USF Alto do Capitão": "Rua Tupiraçaba, S/N",
        "USF Cidade Operária": "Rua Emílio Monteiro da Fonseca, 1688",
        "USF Ilha de Deus": "Rua José, S/N, Ilha de Deus",
        "USF Ilha de Santa Terezinha": "Rua Artemis, 09, Santo Amaro",
        "USF Rio Pajeú": "Rua Rio Pajeú, S/N",
        "USF Sítio das Palmeiras": "Rua Felixlândia, 176, Cordeiro",
        "USF Sítio Grande": "Av. Luxemburgo, 240, Imbiribeira"
    };

    // Preencher a lista de sugestões (Datalist)
    const datalist = document.getElementById('listaUnidades');
    Object.keys(unidadesData).forEach(nome => {
        const option = document.createElement('option');
        option.value = nome;
        datalist.appendChild(option);
    });

    // Evento para preencher endereço automaticamente
    const inputUnidade = document.getElementById('inputUnidade');
    const inputEndereco = document.getElementById('inputEnderecoUnidade');

    inputUnidade.addEventListener('input', function() {
        const nomeSelecionado = this.value;
        if (unidadesData[nomeSelecionado]) {
            inputEndereco.value = unidadesData[nomeSelecionado];
        } else {
            inputEndereco.value = "";
        }
    });


    // --- LÓGICA DE CEP (API VIACEP) ---
    const campoCEP = document.getElementById('campoCEP');
    const msgCEP = document.getElementById('msgCEP');
    const campoLogradouro = document.getElementById('end_logradouro');
    const campoBairro = document.getElementById('end_bairro');
    const campoNumero = document.getElementById('end_numero');

    campoCEP.addEventListener('blur', function() {
        let cep = this.value.replace(/\D/g, '');
        
        if (cep.length === 8) {
            msgCEP.style.display = 'block';
            msgCEP.innerText = 'Buscando...';
            msgCEP.style.color = '#0056b3';
            
            fetch(`https://viacep.com.br/ws/${cep}/json/`)
                .then(response => response.json())
                .then(data => {
                    if (!data.erro) {
                        campoLogradouro.value = data.logradouro;
                        campoBairro.value = data.bairro;
                        msgCEP.style.display = 'none';
                        campoNumero.focus(); 
                    } else {
                        msgCEP.innerText = 'CEP não encontrado.';
                        msgCEP.style.color = 'red';
                        campoLogradouro.value = '';
                        campoBairro.value = '';
                    }
                })
                .catch(() => {
                    msgCEP.innerText = 'Erro na busca.';
                    msgCEP.style.color = 'red';
                });
        }
    });

    // Lógica do campo 'Outra Deficiência'
    const selectDeficiencia = document.getElementById('selectDeficiencia');
    const divOutra = document.getElementById('divOutraDeficiencia');
    const inputOutra = document.getElementById('inputOutraDeficiencia');

    selectDeficiencia.addEventListener('change', function() {
        if (this.value === 'Outra') {
            divOutra.style.display = 'block';
            inputOutra.required = true;
        } else {
            divOutra.style.display = 'none';
            inputOutra.required = false;
            inputOutra.value = '';
        }
    });

    // Máscaras
    const mascaraCPF = (v) => {
        v = v.replace(/\D/g, "");
        v = v.replace(/(\d{3})(\d)/, "$1.$2");
        v = v.replace(/(\d{3})(\d)/, "$1.$2");
        v = v.replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        return v;
    };

    const mascaraCNS = (v) => {
        v = v.replace(/\D/g, "");
        v = v.replace(/(\d{3})(\d)/, "$1 $2");
        v = v.replace(/(\d{4})(\d)/, "$1 $2");
        v = v.replace(/(\d{4})(\d)/, "$1 $2");
        return v;
    };

    const mascaraTel = (v) => {
        v = v.replace(/\D/g, "");
        v = v.replace(/^(\d{2})(\d)/g, "($1) $2");
        v = v.replace(/(\d)(\d{4})$/, "$1-$2");
        return v;
    };

    const mascaraCEP = (v) => {
        v = v.replace(/\D/g, "");
        v = v.replace(/^(\d{5})(\d)/, "$1-$2");
        return v;
    };

    document.getElementById('CPF').addEventListener('input', (e) => e.target.value = mascaraCPF(e.target.value));
    document.getElementById('CNS').addEventListener('input', (e) => e.target.value = mascaraCNS(e.target.value));
    document.getElementById('campoCEP').addEventListener('input', (e) => e.target.value = mascaraCEP(e.target.value));
    ['Tel1', 'Tel2', 'TelUnit'].forEach(id => {
        document.getElementById(id).addEventListener('input', (e) => e.target.value = mascaraTel(e.target.value));
    });

    // --- VALIDAÇÃO DE CPF ---
    function validarCPF(cpf) {
        cpf = cpf.replace(/[^\d]+/g, '');
        if (cpf == '') return false;
        if (cpf.length != 11 || 
            cpf == "00000000000" || 
            cpf == "11111111111" || 
            cpf == "22222222222" || 
            cpf == "33333333333" || 
            cpf == "44444444444" || 
            cpf == "55555555555" || 
            cpf == "66666666666" || 
            cpf == "77777777777" || 
            cpf == "88888888888" || 
            cpf == "99999999999") 
                return false;
        let add = 0;
        for (let i = 0; i < 9; i++) add += parseInt(cpf.charAt(i)) * (10 - i);
        let rev = 11 - (add % 11);
        if (rev == 10 || rev == 11) rev = 0;
        if (rev != parseInt(cpf.charAt(9))) return false;
        add = 0;
        for (let i = 0; i < 10; i++) add += parseInt(cpf.charAt(i)) * (11 - i);
        rev = 11 - (add % 11);
        if (rev == 10 || rev == 11) rev = 0;
        if (rev != parseInt(cpf.charAt(10))) return false;
        return true;
    }

    // --- VALIDAÇÃO DE CNS ---
    function validarCNS(cns) {
        cns = cns.replace(/\D/g, "");
        if (cns.length !== 15) return false;
        let soma = 0;
        for (let i = 0; i < 15; i++) {
            soma += parseInt(cns.charAt(i)) * (15 - i);
        }
        return soma % 11 === 0;
    }

    form.addEventListener('submit', e => {
        e.preventDefault();
        
        let temErro = false;

        // Validar CPF
        const cpfInput = document.getElementById('CPF');
        const cpfMsg = cpfInput.nextElementSibling;
        if (!validarCPF(cpfInput.value)) {
            cpfInput.classList.add('error');
            cpfMsg.style.display = 'block';
            temErro = true;
        } else {
            cpfInput.classList.remove('error');
            cpfMsg.style.display = 'none';
        }

        // Validar CNS
        const cnsInput = document.getElementById('CNS');
        const cnsMsg = cnsInput.nextElementSibling;
        if (!validarCNS(cnsInput.value)) {
            cnsInput.classList.add('error');
            cnsMsg.style.display = 'block';
            temErro = true;
        } else {
            cnsInput.classList.remove('error');
            cnsMsg.style.display = 'none';
        }

        // Validar Telefones (Tamanho e Duplicidade)
        const tel1Input = document.getElementById('Tel1');
        const tel2Input = document.getElementById('Tel2');
        const tel1Clean = tel1Input.value.replace(/\D/g, "");
        const tel2Clean = tel2Input.value.replace(/\D/g, "");
        
        const msgTel2 = document.getElementById('msg-tel2');
        const msgDup = document.getElementById('msg-duplicate-tel');
        
        // Reset msg duplicidade
        msgDup.style.display = 'none';
        
        // Valida tamanho Tel 1
        if (tel1Clean.length !== 11) {
            tel1Input.classList.add('error');
            tel1Input.nextElementSibling.style.display = 'block';
            temErro = true;
        } else {
            tel1Input.classList.remove('error');
            tel1Input.nextElementSibling.style.display = 'none';
        }

        // Valida tamanho Tel 2
        if (tel2Clean.length !== 11) {
            tel2Input.classList.add('error');
            msgTel2.style.display = 'block';
            temErro = true;
        } else {
            tel2Input.classList.remove('error');
            msgTel2.style.display = 'none';
        }

        // Valida se são IGUAIS (e se ambos estão preenchidos corretamente)
        if (tel1Clean.length === 11 && tel2Clean.length === 11 && tel1Clean === tel2Clean) {
            tel2Input.classList.add('error');
            msgDup.style.display = 'block';
            temErro = true;
        }

        // --- CONCATENAÇÃO DO ENDEREÇO DA CRIANÇA ---
        const logradouro = document.getElementById('end_logradouro').value;
        const bairro = document.getElementById('end_bairro').value;
        const numero = document.getElementById('end_numero').value;
        const complemento = document.getElementById('end_complemento').value;
        const enderecoCompleto = `${logradouro}, Nº ${numero}, ${bairro}${complemento ? ' - ' + complemento : ''}`;
        document.getElementById('enderecoFinal').value = enderecoCompleto;

        if (temErro) {
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return;
        }

        loading.style.display = 'block';
        btn.disabled = true;
        btn.style.opacity = '0.5';

        fetch(scriptURL, { method: 'POST', body: new FormData(form)})
            .then(response => {
                loading.style.display = 'none';
                formContent.style.display = 'none';
                successMessage.style.display = 'block';
                window.scrollTo({ top: 0, behavior: 'smooth' });
            })
            .catch(error => {
                console.error('Error!', error.message);
                loading.innerText = "Erro na conexão. Tente novamente.";
                btn.disabled = false;
                btn.style.opacity = '1';
            });
    });
</script>

</body>
</html>
